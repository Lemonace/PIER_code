# coding: utf-8 -*-
import shutil
import time
import os

# result
RANDOM_SEED = 2022
BATCH_SIZE = 1024
IMP_LOSS_WEIGHT = 0.02
# basic config
EPOCH = 1 
LEARNING_RATE = 0.001
DATA_MODE = 3 # 1:local train，2:local test, 3:docker evaluate
TRAIN_MODE = 3
MODEL_NAME = "pier_listwise_whole_v4"

USE_CONSTRATIVE_LOSS = True
CONSTRATIVE_LOSS_K = 0.01

# poi类别特征
FEATURE_CATE_NUM = 7 # v1r3:19
# dense特征
FEATURE_DENSE_NUM = 5  # v1:28 v1r2:79 v1r3:83
# 预估值特征
FEATURE_CXR_NUM = 3
# 环境特征
FEATURE_ENV_NUM = 2
# 自然poi
FEATURE_NATURE_POI = 25

# embedding_look_up维度
CATE_FEATURE_EMBEDDINGS_SHAPE = [1 << 22, 8]

# hash vector
HASH_VECTOR = [[0.4011729380078948, 0.9907933488085712, 0.889170658914898, 0.015553701343792192, 0.2269008585804, 0.889609750280199, 0.19280345796299014, 0.33362195188257815],
               [0.1174580997476552, 0.4475570392889796, 0.9925939893135071, 0.7296640075216434, 0.6436313332140967, 0.8568068597644793, 0.9018604021483339, 0.28774343258170776],
               [0.4374993384759095, 0.6807149381274915, 0.20502126763268802, 0.6968687323602859, 0.6449029002244834, 0.08732080642447282, 0.6119476780855001, 0.8616788453789646],
               [0.19344266090314144, 0.4268233179146762, 0.10951597767480326, 0.9867838283258178, 0.8340011944969644, 0.7992329879482085, 0.005303560724105649, 0.9662924610057512],
               [0.5824282763301396, 0.5090708710943849, 0.4462703076663568, 0.5482943153972023, 0.06782829736851825, 0.08907408658464577, 0.13400486343251583, 0.1848228429919272]]

POSITION_ENCODING = [[0.08790239841717873, 0.033267486152506076, 0.5495130189114207, 0.17419777583517537, 0.6838981992197484, 0.07935154925635501, 0.02665372302227631, 0.4181008411574786],
                     [0.02038159041970189, 0.9310485215006198, 0.723661313625571, 0.5110323516977285, 0.7812851438212606, 0.40722710713947474, 0.04646490014890503, 0.9565353323381218],
                     [0.17279361698259843, 0.12968275664201512, 0.3183103529758954, 0.6360591081256931, 0.1558507653689548, 0.5972802646455662, 0.4380619835390329, 0.6088094249662641],
                     [0.038262298606345335, 0.9999545626217287, 0.7113776275017341, 0.5434618368150265, 0.6853527957705402, 0.9662653254145415, 0.9641592716989676, 0.3443813983264],
                     [0.7903243938847678, 0.9952713339078417, 0.8741415264071601, 0.45665348276461737, 0.7693872696125916, 0.772509599868299, 0.2540369924156157, 0.24781240400239857]]


TIME_AWARE_WEIGHT = [[1/2,1/2,1/3,1/3,1/4]]
PERMUATION_SIZE = 120
TOP_K = 20


EXPOSE_RATE_FOR_BEAM_SEARCH = [[1.0,0.9,0.8,0.7,0.6]]

# N: Cut Number of POI For Train
POI_NUM = 5
FEATURE_NUM = 9
PAGE_NUM = 5
FEATURE_NUM_FOR_PAGE = 11

# 属性特征：KA AOR BRAND
FEATURE_ATTR_NUM = 3

# DELIVERY_FEAT
DELIVERY_FEAT_NUM = 4

# OUT NUM
OUT_NUM = 1

PLACE_HOLDER_NUM = 11
DENSE_FEAT_NUM = 439


# 网络结构参数
MODEL_PARAMS = {
    'INPUT_TENSOR_LAYERS_A': [60, 32, 20],
    'INPUT_TENSOR_LAYERS_B': [128, 32],
    'INPUT_TENSOR_LAYERS_C': [50, 20],
    'INPUT_TENSOR_LAYERS_D': [50, 20],
    'INPUT_TENSOR_LAYERS_E': [50, 20]
}
# A_INPUT_DIM = POI_NUM * (MODEL_PARAMS['INPUT_TENSOR_LAYERS_A'][-1] + 1)
MLP_INPUT_DIM = CATE_FEATURE_EMBEDDINGS_SHAPE[1] * 3 + 1 + MODEL_PARAMS['INPUT_TENSOR_LAYERS_A'][-1]
DIN_CONF = {}

# train data
# /users/lemonace/Downloads/tfrecord-rl-limit5-v1
if DATA_MODE == 1:
    TRAIN_FILE = ['/users/meituan_sxw/Downloads/part-r-00046']
    VALID_FILE = TRAIN_FILE
    PREDICT_FILE = VALID_FILE
    TEST_FILE = PREDICT_FILE
elif DATA_MODE == 2:
    TRAIN_FILE = ['/mnt/dolphinfs/hdd_pool/docker/user/hadoop-hmart-waimaiad/yangfan129/train_data/avito_v1_new/avito_v1_new/test_data/part-r-*']
    VALID_FILE = TRAIN_FILE
    TEST_FILE = VALID_FILE
elif DATA_MODE == 3:
    TRAIN_FILE = ["/mnt/dolphinfs/hdd_pool/docker/user/hadoop-hmart-waimaiad/yangfan129/train_data/avito_v3_new/train_data/part-r-000*1"]
    VALID_FILE = ["/mnt/dolphinfs/hdd_pool/docker/user/hadoop-hmart-waimaiad/yangfan129/train_data/avito_v3_new/test_data/part-r-000*1"]
    TEST_FILE= ["/mnt/dolphinfs/hdd_pool/docker/user/hadoop-hmart-waimaiad/yangfan129/train_data/avito_v3_new/test_data/part-r-000*1"]
elif DATA_MODE == 4:
    DATA_FILE = "/home/hadoop-hmart-waimaiad/cephfs/data/yangfan129/train_data/tfrecord-multi-channel-v1/"
    #TRAIN_LIST = ["20211222", "20211223", "20211224", "20211225"]
    TRAIN_LIST = ["20220123"]
    VALID_LIST = ["20220124"]
    TRAIN_FILE = [DATA_FILE + x + "/part-r-*" for x in TRAIN_LIST]
    VALID_FILE = [DATA_FILE + x + "/part-r-0001*" for x in VALID_LIST]
    TEST_FILE = [DATA_FILE + x + "/part-r-00011" for x in TRAIN_LIST]

# 辅助脚本
MEAN_VAR_PATH_POI = "./avg_std/poi"
MEAN_VAR_PATH_DELIVERY = "./avg_std/delivery"
MODEL_SAVE_PATH = "../model/" + MODEL_NAME
MODEL_SAVE_PB_EPOCH_ON = False
MODEL_SAVE_PB_EPOCH_PATH = MODEL_SAVE_PATH + "_pbs"
